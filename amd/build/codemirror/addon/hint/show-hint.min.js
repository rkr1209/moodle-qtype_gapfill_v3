function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module)))a(require("../../lib/codemirror"));else if("function"==typeof define&&define.amd)define ("qtype_gapfill/codemirror/addon/hint/show-hint",["../../lib/codemirror"],a);else a(CodeMirror)})(function(a){"use strict";var k="CodeMirror-hint-active";a.showHint=function(a,b,c){if(!b)return a.showHint(c);if(c&&c.async)b.async=!0;var d={hint:b};if(c)for(var e in c){d[e]=c[e]}return a.showHint(d)};a.defineExtension("showHint",function(d){d=c(this,this.getCursor("start"),d);var e=this.listSelections();if(1<e.length)return;if(this.somethingSelected()){if(!d.hint.supportsSelection)return;for(var f=0;f<e.length;f++){if(e[f].head.line!=e[f].anchor.line)return}}if(this.state.completionActive)this.state.completionActive.close();var g=this.state.completionActive=new b(this,d);if(!g.options.hint)return;a.signal(this,"startCompletion",this);g.update(!0)});a.defineExtension("closeHint",function(){if(this.state.completionActive)this.state.completionActive.close()});function b(a,b){this.cm=a;this.options=b;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;if(this.options.updateOnCursorActivity){var c=this;a.on("cursorActivity",this.activityFunc=function(){c.cursorActivity()})}}var l=window.requestAnimationFrame||function(a){return setTimeout(a,1e3/60)},m=window.cancelAnimationFrame||clearTimeout;b.prototype={close:function close(){if(!this.active())return;this.cm.state.completionActive=null;this.tick=null;if(this.options.updateOnCursorActivity){this.cm.off("cursorActivity",this.activityFunc)}if(this.widget&&this.data)a.signal(this.data,"close");if(this.widget)this.widget.close();a.signal(this.cm,"endCompletion",this.cm)},active:function active(){return this.cm.state.completionActive==this},pick:function pick(b,c){var e=b.list[c],f=this;this.cm.operation(function(){if(e.hint)e.hint(f.cm,b,e);else f.cm.replaceRange(d(e),e.from||b.from,e.to||b.to,"complete");a.signal(b,"pick",e);f.cm.scrollIntoView()});if(this.options.closeOnPick){this.close()}},cursorActivity:function cursorActivity(){if(this.debounce){m(this.debounce);this.debounce=0}var a=this.startPos;if(this.data){a=this.data.from}var b=this.cm.getCursor(),c=this.cm.getLine(b.line);if(b.line!=this.startPos.line||c.length-b.ch!=this.startLen-this.startPos.ch||b.ch<a.ch||this.cm.somethingSelected()||!b.ch||this.options.closeCharacters.test(c.charAt(b.ch-1))){this.close()}else{var d=this;this.debounce=l(function(){d.update()});if(this.widget)this.widget.disable()}},update:function update(a){if(null==this.tick)return;var b=this,c=++this.tick;j(this.options.hint,this.cm,this.options,function(d){if(b.tick==c)b.finishUpdate(d,a)})},finishUpdate:function finishUpdate(b,c){if(this.data)a.signal(this.data,"update");var d=this.widget&&this.widget.picked||c&&this.options.completeSingle;if(this.widget)this.widget.close();this.data=b;if(b&&b.list.length){if(d&&1==b.list.length){this.pick(b,0)}else{this.widget=new g(this,b);a.signal(b,"shown")}}}};function c(a,b,c){var d=a.options.hintOptions,e={};for(var f in n){e[f]=n[f]}if(d)for(var f in d){if(d[f]!==void 0)e[f]=d[f]}if(c)for(var f in c){if(c[f]!==void 0)e[f]=c[f]}if(e.hint.resolve)e.hint=e.hint.resolve(a,b);return e}function d(a){if("string"==typeof a)return a;else return a.text}function e(a,b){var d={Up:function Up(){b.moveFocus(-1)},Down:function Down(){b.moveFocus(1)},PageUp:function PageUp(){b.moveFocus(-b.menuSize()+1,!0)},PageDown:function PageDown(){b.moveFocus(b.menuSize()-1,!0)},Home:function Home(){b.setFocus(0)},End:function End(){b.setFocus(b.length-1)},Enter:b.pick,Tab:b.pick,Esc:b.close},e=/Mac/.test(navigator.platform);if(e){d["Ctrl-P"]=function(){b.moveFocus(-1)};d["Ctrl-N"]=function(){b.moveFocus(1)}}var f=a.options.customKeys,g=f?{}:d;function c(a,c){var e;if("string"!=typeof c)e=function(a){return c(a,b)};else if(d.hasOwnProperty(c))e=d[c];else e=c;g[a]=e}if(f)for(var h in f){if(f.hasOwnProperty(h))c(h,f[h])}var i=a.options.extraKeys;if(i)for(var h in i){if(i.hasOwnProperty(h))c(h,i[h])}return g}function f(a,b){while(b&&b!=a){if("LI"===b.nodeName.toUpperCase()&&b.parentNode==a)return b;b=b.parentNode}}function g(b,c){this.completion=b;this.data=c;this.picked=!1;var g=this,h=b.cm,j=h.getInputField().ownerDocument,l=j.defaultView||j.parentWindow,m=this.hints=j.createElement("ul"),n=b.cm.options.theme;m.className="CodeMirror-hints "+n;this.selectedHint=c.selectedHint||0;for(var o=c.list,p=0;p<o.length;++p){var q=m.appendChild(j.createElement("li")),r=o[p],s="CodeMirror-hint"+(p!=this.selectedHint?"":" "+k);if(null!=r.className)s=r.className+" "+s;q.className=s;if(r.render)r.render(q,c,r);else q.appendChild(j.createTextNode(r.displayText||d(r)));q.hintId=p}var t=b.options.container||j.body,u=h.cursorCoords(b.options.alignWithWord?c.from:null),v=u.left,w=u.bottom,x=!0,y=0,z=0;if(t!==j.body){var A=-1!==["absolute","relative","fixed"].indexOf(l.getComputedStyle(t).position),B=A?t:t.offsetParent,C=B.getBoundingClientRect(),D=j.body.getBoundingClientRect();y=C.left-D.left-B.scrollLeft;z=C.top-D.top-B.scrollTop}m.style.left=v-y+"px";m.style.top=w-z+"px";var E=l.innerWidth||Math.max(j.body.offsetWidth,j.documentElement.offsetWidth),F=l.innerHeight||Math.max(j.body.offsetHeight,j.documentElement.offsetHeight);t.appendChild(m);var G=b.options.moveOnOverlap?m.getBoundingClientRect():new DOMRect,H=b.options.paddingForScrollbar?m.scrollHeight>m.clientHeight+1:!1,I;setTimeout(function(){I=h.getScrollInfo()});var J=G.bottom-F;if(0<J){var K=G.bottom-G.top,L=u.top-(u.bottom-G.top);if(0<L-K){m.style.top=(w=u.top-K-z)+"px";x=!1}else if(K>F){m.style.height=F-5+"px";m.style.top=(w=u.bottom-G.top-z)+"px";var M=h.getCursor();if(c.from.ch!=M.ch){u=h.cursorCoords(M);m.style.left=(v=u.left-y)+"px";G=m.getBoundingClientRect()}}}var N=G.right-E;if(0<N){if(G.right-G.left>E){m.style.width=E-5+"px";N-=G.right-G.left-E}m.style.left=(v=u.left-N-y)+"px"}if(H)for(var O=m.firstChild;O;O=O.nextSibling){O.style.paddingRight=h.display.nativeBarWidth+"px"}h.addKeyMap(this.keyMap=e(b,{moveFocus:function moveFocus(a,b){g.changeActive(g.selectedHint+a,b)},setFocus:function setFocus(a){g.changeActive(a)},menuSize:function menuSize(){return g.screenAmount()},length:o.length,close:function close(){b.close()},pick:function pick(){g.pick()},data:c}));if(b.options.closeOnUnfocus){var P;h.on("blur",this.onBlur=function(){P=setTimeout(function(){b.close()},100)});h.on("focus",this.onFocus=function(){clearTimeout(P)})}h.on("scroll",this.onScroll=function(){var a=h.getScrollInfo(),c=h.getWrapperElement().getBoundingClientRect(),d=w+I.top-a.top,e=d-(l.pageYOffset||(j.documentElement||j.body).scrollTop);if(!x)e+=m.offsetHeight;if(e<=c.top||e>=c.bottom)return b.close();m.style.top=d+"px";m.style.left=v+I.left-a.left+"px"});a.on(m,"dblclick",function(a){var b=f(m,a.target||a.srcElement);if(b&&null!=b.hintId){g.changeActive(b.hintId);g.pick()}});a.on(m,"click",function(a){var c=f(m,a.target||a.srcElement);if(c&&null!=c.hintId){g.changeActive(c.hintId);if(b.options.completeOnSingleClick)g.pick()}});a.on(m,"mousedown",function(){setTimeout(function(){h.focus()},20)});var Q=this.getSelectedHintRange();if(0!==Q.from||0!==Q.to){this.scrollToActive()}a.signal(c,"select",o[this.selectedHint],m.childNodes[this.selectedHint]);return!0}g.prototype={close:function close(){if(this.completion.widget!=this)return;this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var a=this.completion.cm;if(this.completion.options.closeOnUnfocus){a.off("blur",this.onBlur);a.off("focus",this.onFocus)}a.off("scroll",this.onScroll)},disable:function disable(){this.completion.cm.removeKeyMap(this.keyMap);var a=this;this.keyMap={Enter:function Enter(){a.picked=!0}};this.completion.cm.addKeyMap(this.keyMap)},pick:function pick(){this.completion.pick(this.data,this.selectedHint)},changeActive:function changeActive(b,c){if(b>=this.data.list.length)b=c?this.data.list.length-1:0;else if(0>b)b=c?0:this.data.list.length-1;if(this.selectedHint==b)return;var d=this.hints.childNodes[this.selectedHint];if(d)d.className=d.className.replace(" "+k,"");d=this.hints.childNodes[this.selectedHint=b];d.className+=" "+k;this.scrollToActive();a.signal(this.data,"select",this.data.list[this.selectedHint],d)},scrollToActive:function scrollToActive(){var a=this.getSelectedHintRange(),b=this.hints.childNodes[a.from],c=this.hints.childNodes[a.to],d=this.hints.firstChild;if(b.offsetTop<this.hints.scrollTop)this.hints.scrollTop=b.offsetTop-d.offsetTop;else if(c.offsetTop+c.offsetHeight>this.hints.scrollTop+this.hints.clientHeight)this.hints.scrollTop=c.offsetTop+c.offsetHeight-this.hints.clientHeight+d.offsetTop},screenAmount:function screenAmount(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1},getSelectedHintRange:function getSelectedHintRange(){var a=this.completion.options.scrollMargin||0;return{from:Math.max(0,this.selectedHint-a),to:Math.min(this.data.list.length-1,this.selectedHint+a)}}};function h(a,b){if(!a.somethingSelected())return b;for(var c=[],d=0;d<b.length;d++){if(b[d].supportsSelection)c.push(b[d])}return c}function j(a,b,c,d){if(a.async){a(b,d,c)}else{var e=a(b,c);if(e&&e.then)e.then(d);else d(e)}}a.registerHelper("hint","auto",{resolve:function(b,c){var d=b.getHelpers(c,"hint"),e;if(d.length){var f=function(a,b,c){var f=h(a,d);function e(d){if(d==f.length)return b(null);j(f[d],a,c,function(a){if(a&&0<a.list.length)b(a);else e(d+1)})}e(0)};f.async=!0;f.supportsSelection=!0;return f}else if(e=b.getHelper(b.getCursor(),"hintWords")){return function(b){return a.hint.fromList(b,{words:e})}}else if(a.hint.anyword){return function(b,c){return a.hint.anyword(b,c)}}else{return function(){}}}});a.registerHelper("hint","fromList",function(b,c){var d=b.getCursor(),e=b.getTokenAt(d),f,g=a.Pos(d.line,e.start);if(e.start<d.ch&&/\w/.test(e.string.charAt(d.ch-e.start-1))){f=e.string.substr(0,d.ch-e.start)}else{f="";g=d}for(var h=[],j=0,k;j<c.words.length;j++){k=c.words[j];if(k.slice(0,f.length)==f)h.push(k)}if(h.length)return{list:h,from:g,to:d}});a.commands.autocomplete=a.showHint;var n={hint:a.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnPick:!0,closeOnUnfocus:!0,updateOnCursorActivity:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null,paddingForScrollbar:!0,moveOnOverlap:!0};a.defineOption("hintOptions",null)});
//# sourceMappingURL=show-hint.min.js.map
